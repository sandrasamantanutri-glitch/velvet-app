<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Velvet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>


<div class="page-wrapper">

  <div class="landing">

    <!-- CAPA -->
    <div class="landing-cover">
      <img src="assets/cap.png" alt="Capa Velvet">
    </div>

    <!-- LOGIN -->
    <div class="landing-login">

      <img src="assets/velvet.png" class="logo" alt="Velvet">

      <div class="login-box">
        <button class="btn btn-creator" onclick="selectRole('creator')">
          Sou Influencer 
        </button>

        <button class="btn btn-member" onclick="selectRole('client')">
          Sou Membro
        </button>
      </div>

      <!-- INPUTS -->
<script>
let modalMode = "login"; // login | register

function selectRole(role) {
  openLoginModal();
}

function openLoginModal() {
  modalMode = "login";
  updateModal();
  document.getElementById("loginModal").classList.remove("hidden");
}

function closeLoginModal() {
  document.getElementById("loginModal").classList.add("hidden");
}

function switchToRegister() {
  modalMode = "register";
  updateModal();
}

function switchToLogin() {
  modalMode = "login";
  updateModal();
}

function updateModal() {
  const title = document.getElementById("modalTitle");
  const submit = document.getElementById("modalSubmit");
  const roleSelect = document.getElementById("registerRole");
  const switchLogin = document.getElementById("switchToLogin");
  const switchRegister = document.querySelector(".modal-switch");

  if (modalMode === "login") {
    title.textContent = "Entrar no Velvet";
    submit.textContent = "Entrar";
    submit.onclick = login;
    roleSelect.classList.add("hidden");
    switchRegister.classList.remove("hidden");
    switchLogin.classList.add("hidden");
  } else {
    title.textContent = "Criar conta no Velvet";
    submit.textContent = "Criar conta";
    submit.onclick = register;
    roleSelect.classList.remove("hidden");
    switchRegister.classList.add("hidden");
    switchLogin.classList.remove("hidden");
  }
}

async function login() {
  const email = document.getElementById("loginEmail").value.trim();
  const senha = document.getElementById("loginSenha").value.trim();

  if (!email || !senha) {
    alert("Preencha email e senha");
    return;
  }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email, senha })
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.erro || "Erro no login");
      return;
    }

    // ðŸ” SALVAR TOKEN
    localStorage.setItem("token", data.token);
    localStorage.setItem("role", data.role);

    // ðŸ” REDIRECIONAR PELO ROLE
    if (data.role === "modelo") {
      window.location.href = "/profile.html";
    } else if (data.role === "cliente") {
      window.location.href = "/clientHome.html";
    } else {
      window.location.href = "/";
    }

  } catch (err) {
    console.error(err);
    alert("Erro de conexÃ£o com o servidor");
  }
}


async function register() {
  const email = document.getElementById("loginEmail").value;
  const senha = document.getElementById("loginSenha").value;
  const role = document.getElementById("registerRole").value;

  console.log("REGISTER DEBUG:", { email, senha, role });

  if (!email || !senha || !role) {
    alert("Preencha todos os campos");
    return;
  }

  const res = await fetch("/api/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, senha, role,
       nome: email.split("@")[0]
     })
  });

  const data = await res.json();

if (!res.ok) {
  alert(data.erro || "Erro ao criar conta");
  return;
}

alert("Conta criada com sucesso! Agora faÃ§a login.");
switchToLogin();
}

function redirectUser(role) {
  closeLoginModal();

  if (role === "modelo") {
    window.location.href = "/profile.html";
  } else {
    window.location.href = "/clientHome.html";
  }
}

function openRegisterFromFooter() {
  modalMode = "register";
  updateModal();
  document.getElementById("loginModal").classList.remove("hidden");
}

function switchToRegister() {
  modalMode = "register";
  document.getElementById("registerRole").value = "";
  updateModal();
}

  const modal = document.getElementById("ageModal");

  if (!localStorage.getItem("ageConfirmed")) {
    modal.classList.remove("hidden");
  }

  document.getElementById("ageYes").onclick = () => {
    localStorage.setItem("ageConfirmed", "true");
    modal.classList.add("hidden");
  };

  document.getElementById("ageNo").onclick = () => {
    window.location.href = "https://google.com";
  };



</script>

      <div class="footer-links">
        <a href="#">Contato</a>
        <a href="#">Termos</a>
        <a href="#">Privacidade</a>
        <a href="#" onclick="openRegisterFromFooter()">Criar conta</a>
      </div>

<!-- LOGIN / REGISTER MODAL -->
<div id="loginModal" class="modal hidden">
  <div class="modal-overlay" onclick="closeLoginModal()"></div>

  <div class="modal-box">
    <h2 id="modalTitle">Entrar no Velvet</h2>

    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginSenha" type="password" placeholder="Senha">

    <!-- REGISTRO -->
    <select id="registerRole" class="hidden">
      <option value="">Escolha o tipo de conta</option>
      <option value="modelo">Sou Influencer</option>
      <option value="cliente">Sou Membro</option>
    </select>

    <button id="modalSubmit" class="btn btn-primary" onclick="login()">
      Entrar
    </button>

    <p class="modal-switch">
      NÃ£o tem conta?
      <span onclick="switchToRegister()">Criar conta</span>
    </p>

    <p class="modal-switch hidden" id="switchToLogin">
      JÃ¡ tem conta?
      <span onclick="switchToLogin()">Entrar</span>
    </p>

    <button class="modal-close" onclick="closeLoginModal()">âœ•</button>
  </div>
</div>
<div id="ageModal" class="age-modal hidden">
  <div class="age-box">
    <h2>ConteÃºdo adulto</h2>
    <p>VocÃª confirma que tem 18 anos ou mais?</p>

    <div class="age-actions">
      <button id="ageYes">Sim, tenho 18+</button>
      <button id="ageNo">NÃ£o</button>
    </div>

    <p class="age-legal">
      Ao continuar, vocÃª aceita os
      <a href="/terms.html" target="_blank">Termos</a> e a
      <a href="/privacy.html" target="_blank">Privacidade</a>.
    </p>
  </div>
</div>

</body>
</html>
